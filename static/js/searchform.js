require(["jquery","components/gettext","jquery.ui"],function(e,t){var n=t.gettext;e(".extended.searchform").each(function(){function l(t,n,r){var i=e('<ul class="query-choose"></ul>');e.each(n,function(n,s){i.append(e('<li><a class="button" href="#">'+s[1]+"</a></li>").on("click tap","a",function(){return r(t,s[1],s[0]),i.dialog("close").dialog("destroy").remove(),i=null,!1}))}),i.dialog({title:t,modal:!0,width:Math.min(e(window).width(),1030)})}function c(t,r,i){var o="",u=jQuery.noop;return i.is("select")?(o=" y",u=function(){return i.find('option[value=""]')[0].selected=!1,i.find('option[value="1"]')[0].selected?(i.find('option[value="1"]')[0].selected=!1,i.find('option[value="0"]')[0].selected=!0,e(this).find(".value").addClass("n").removeClass("y")):(i.find('option[value="0"]')[0].selected=!1,i.find('option[value="1"]')[0].selected=!0,e(this).find(".value").addClass("y").removeClass("n")),!1}):u=function(){var n=e(this),r=a[t];l(t,r,function(e,t,r){n.find(".value").text(t),i[0].checked=!1,r[0].checked=!0})},e('<li class="query-item"></li>').html('<span class="key">'+t+':</span> <span class="value'+o+'" title="'+n("click to change")+'">'+r+'</span> <button type="button">'+n("remove")+"</button>").find("button").button({text:!1,icons:{primary:"ui-icon-close",secondary:!1}}).on("click tab",function(){var t=e(this).closest("li");return i.is(":checkbox")?i[0].checked=!1:i.find('option[value=""]')[0].selected=!0,t.slideUp("fast",t.remove),!1}).end().on("click tab",u).tooltip().appendTo(s)}var t=e(this),r=e(".propsearch, .boolsearch",t).hide(),i=e(".submitset",t),s=e('<ul class="query-add ui-widget ui-widget-content ui-corner-all"></ul>').insertBefore(i),o=e(),u=e('<p><button type="button">'+n("+ add new query")+"</button></p>").insertBefore(i).find("button"),a={},f=e('<ul class="ui-menu ui-widget ui-widget-content" tabindex="0"></ul>');r.filter(".propsearch").each(function(){var t=e(this),n=[],r=e("legend",t).text().replace(/:\s*$/,"");e(":checkbox",t).each(function(){var i=e(this),s=e('label[for="'+this.id+'"]',t).text();n.push([i,s]),i[0].checked&&c(r,s,i)}),a[r]=n}),a["Other Property"]=[],r.filter(".boolsearch").each(function(){var t=e("select",this),n=e("label",this).text();a["Other Property"].push([t,n]),t.find('option[value="1"]')[0].selected&&c("Other Property",n,t)}),e.each(a,function(t,n){f.append(e('<li class="ui-menu-item"><a href="#">'+t+"</a></li>").data("v",n).data("k",t))}),e(document).on("keydown click tap",function(){f.slideUp()}),f.css({display:"none",position:"absolute"}).appendTo("body").on("click tap","li",function(){var t=e(this);return l(t.data("k"),t.data("v"),function(e,t,n){n.is(":checkbox")?n[0].checked=!0:n.find('option[value="1"]')[0].selected=!0,c(e,t,n)}),f.slideUp(),!1}).on("keydown",function(t){if(!t.shiftKey&&!t.metaKey&&!t.ctrlKey&&!t.altKey){var n=f.find("a:focus"),r=e();switch(t.which){case 38:n.length&&(r=n.parent().prev("li").find("a")),r.length||(r=f.find("a:last"));break;case 40:n.length&&(r=n.parent().next("li").find("a")),r.length||(r=f.find("a:first"))}if(r.length)return r.focus(),t.preventDefault(),t.stopPropagation(),!1}}),u.on("click tap",function(){return f.show().position({my:"left top",at:"left bottom",of:this,collision:"fit fit"}).hide().slideDown().focus(),!1}),s.on("click tap",function(e){if(e.target===this)return u.trigger("click"),!1})})}),define("searchform",function(){});