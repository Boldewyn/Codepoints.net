(function(a,b,c){function e(a,c){return function(d,e){var f=0,g=b("#sclist").find("dt.sc_"+e);g.length&&(f=parseInt(g.next("dd").find(".nchar").text(),10),isNaN(f)&&(f=0)),e in c&&c[e]&&a.append(b('<section style="margin:0"></section>').append(b("<h3></h3>").text(c[e].name).append(' <small><a href="/search?sc[]='+e+'">('+f+" codepoints)</a></small>")).append(b('<div style="font-size: 12px"></div>').html(c[e].abstract).append('<p class="nt">Source: <a href="'+c[e].src+'">Wikipedia</a></p>')))}}function g(a){var c;return a in f?c=b.when(f[a]):c=b.ajax({url:"/api/script/"+a,dataType:"json"}).done(function(b){f[a]=b}),c}function h(a){var c=a.id,f=d.width();f>800&&(f=800),a.properties.scripts||a.properties.oldscripts?g(a.properties.scripts.join(" ")+" "+a.properties.oldscripts.join(" ")).done(function(c){var d=b("<div></div>"),g;b.each(a.properties.scripts,e(d,c)),a.properties.oldscripts.length&&d.append("<h2>Native, Rare and Historic Scripts</h2>"),b.each(a.properties.oldscripts,e(d,c)),d.dialog({title:"Scripts used in "+a.properties.name,buttons:{OK:function(){b(this).dialog("close")}},width:f})}).fail(function(){h({id:"___not_found___"})}):b("<div>We don’t know about "+a.properties.name+"’s scripts, sorry!</div>").dialog({title:"Nothing Found for "+a.property.name,buttons:{Finished:function(){b(this).dialog("close")}},width:f()})}function p(){n=[d3.event.pageX,d3.event.pageY],o=j.origin(),d3.event.preventDefault()}function q(){if(n){var a=[d3.event.pageX,d3.event.pageY],b=[o[0]+(n[0]-a[0])/8,o[1]+(a[1]-n[1])/8];j.origin(b),k.origin(b),s()}}function r(){n&&(q(),n=null)}function s(a){(a?i.transition().duration(a):i).attr("d",t)}function t(a){return l(k.clip(a))}var d=b(a),f={},i,j=d3.geo.azimuthal().scale(400).origin([-30,20]).mode("orthographic").translate([400,400]),k=d3.geo.greatCircle().origin(j.origin()),l=d3.geo.path().projection(j),m=d3.select("#earth").on("mousedown",p);d3.json("/static/world.json",function(a){i=m.selectAll("path").data(a.features).enter().append("svg:path").attr("d",t).attr("class",function(a){return"sc sc_"+a.properties.scripts.join(" sc_")+" sc_"+a.properties.oldscripts.join(" sc_")}),i.append("svg:title").text(function(a){return a.properties.name}),i.on("click",function(a){h(a)}),b("#athmo").remove().appendTo("#earth")}),b("#sclist").accordion({active:!1,autoHeight:!1,header:">dt",changestart:function(a,c){var d=c.newHeader,e=d.data("dd"),f=d.data("sc");e||(e=d.next("dd"),d.data("dd",e),b.ajax({url:"/api/script/"+f,dataType:"json"}).done(function(a){e.append("<hr/>"+a[f].abstract).append('<p class="nt">Source: <a href="'+a[f].src+'">Wikipedia</a></p>')}));var g=b(),h=d.attr("class").split(/\s+/),i,j;b.each(document.getElementsByTagName("path"),function(){this.setAttribute("class",this.getAttribute("class").replace(/\s*active\s*/," "))});for(i=0,j=h.length;i<j;i++)h[i].substr(0,3)==="sc_"&&h[i].length>3&&(g=g.add(b("path."+h[i])));g.each(function(){this.setAttribute("class",this.getAttribute("class")+" active")})}}),d3.select(a).on("mousemove",q).on("mouseup",r);var n,o})(this,jQuery);