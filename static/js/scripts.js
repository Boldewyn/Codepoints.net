(function(a,b,c){function d(a,c){return function(d,e){var f=0,g=b("#sclist").find("dt.sc_"+e);g.length&&(f=parseInt(g.next("dd").find(".nchar").text(),10),isNaN(f)&&(f=0)),e in c&&c[e]&&a.append(b('<section style="margin:0"></section>').append(b("<h3></h3>").text(c[e].name).append(' <small><a href="/search?sc[]='+e+'">('+f+" codepoints)</a></small>")).append(b('<div style="font-size: 12px"></div>').html(c[e].abstract).append('<p class="nt">Source: <a href="'+c[e].src+'">Wikipedia</a></p>')))}}function f(a){var c;return a in e?c=b.when(e[a]):c=b.ajax({url:"/script/"+a,dataType:"json"}).done(function(b){e[a]=b}),c}function g(c){var e=c.id;c.properties.scripts||c.properties.oldscripts?f(c.properties.scripts.join(" ")+" "+c.properties.oldscripts.join(" ")).done(function(e){var f=b("<div></div>"),g;b.each(c.properties.scripts,d(f,e)),c.properties.oldscripts.length&&f.append("<h2>Native, Rare and Historic Scripts</h2>"),b.each(c.properties.oldscripts,d(f,e)),f.dialog({title:"Scripts used in "+c.properties.name,buttons:{OK:function(){b(this).dialog("close")}},width:b(a).width()-40,modal:!0,resizable:!1})}).fail(function(){g({id:"___not_found___"})}):b("<div>We don’t know about "+c.properties.name+"’s scripts, sorry!</div>").dialog({title:"Nothing Found for "+c.property.name,buttons:{Finished:function(){b(this).dialog("close")}},width:b(a).width()-40,modal:!0,resizable:!1})}function o(){m=[d3.event.pageX,d3.event.pageY],n=i.origin(),d3.event.preventDefault()}function p(){if(m){var a=[d3.event.pageX,d3.event.pageY],b=[n[0]+(m[0]-a[0])/8,n[1]+(a[1]-m[1])/8];i.origin(b),j.origin(b),r()}}function q(){m&&(p(),m=null)}function r(a){(a?h.transition().duration(a):h).attr("d",s)}function s(a){return k(j.clip(a))}var e={},h,i=d3.geo.azimuthal().scale(400).origin([-30,20]).mode("orthographic").translate([400,400]),j=d3.geo.greatCircle().origin(i.origin()),k=d3.geo.path().projection(i),l=d3.select("#earth").on("mousedown",o);d3.json("/static/world.json",function(a){h=l.selectAll("path").data(a.features).enter().append("svg:path").attr("d",s).attr("class",function(a){return"sc sc_"+a.properties.scripts.join(" sc_")+" sc_"+a.properties.oldscripts.join(" sc_")}),h.append("svg:title").text(function(a){return a.properties.name}),h.on("click",function(a){g(a)}),b("#athmo").remove().appendTo("#earth")}),b("#sclist").accordion({active:!1,autoHeight:!1,header:">dt",changestart:function(a,c){var d=c.newHeader,e=d.data("dd"),f=d.data("sc");e||(e=d.next("dd"),d.data("dd",e),b.ajax({url:"/script/"+f,dataType:"json"}).done(function(a){e.append("<hr/>"+a[f].abstract).append('<p class="nt">Source: <a href="'+a[f].src+'">Wikipedia</a></p>')}));var g=b(),h=d.attr("class").split(/\s+/),i,j;b.each(document.getElementsByTagName("path"),function(){this.setAttribute("class",this.getAttribute("class").replace(/\s*active\s*/," "))});for(i=0,j=h.length;i<j;i++)h[i].substr(0,3)==="sc_"&&h[i].length>3&&(g=g.add(b("path."+h[i])));g.each(function(){this.setAttribute("class",this.getAttribute("class")+" active")})}}),d3.select(a).on("mousemove",p).on("mouseup",q);var m,n})(this,jQuery);