define(["jquery","components/jquery.cachedajax"],function(e){var t=null;e.fn.glossary=function(){var n=this.find(".gl");return n.length&&e.cachedAjax("/glossary").done(function(r){var i=e(r);t=i.find("#glossary"),n.each(function(){var n=e(this),r,i,s;r=t.find("dt#"+n.data("term"));if(!r.length)return;r=r.add(r.nextUntil("dd")).add(r.prevUntil("dd")),i=r.nextUntil("dt"),s=e('<div class="tooltip glos"><dl></dl></div>').find("dl").append(r.clone()).append(i.clone()).end().on("mouseenter",function(){s.stop(!0,!0).appendTo("body").show()}).on("mouseleave",function(){n.find(".after").trigger("mouseleave")}).on("click tap",'a[href^="#"]',function(){return window.location.href="/glossary"+this.hash,!1}),n.data("gl",s).append('<span class="after">?</span>').find(".after").on("mouseenter",function(){n.data("gl").stop(!0,!0).show().appendTo("body").position({my:"left bottom",at:"right top",of:n,offset:"10 0",collision:"fit flip"})}).on("mouseleave",function(){n.data("gl").fadeOut(700,function(){e(this).detach()})})})}),this}});